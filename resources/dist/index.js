!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="./src/index.js")}({"./node_modules/redux-thunk/dist/redux-thunk.min.js":function(e,t,n){e.exports=function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return e[i].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){e.exports=n(1)},function(e,t){"use strict";function n(e){return function(t){var n=t.dispatch,i=t.getState;return function(t){return function(o){return"function"==typeof o?o(n,i,e):t(o)}}}}t.__esModule=!0;var i=n();i.withExtraArgument=n,t.default=i}])},"./node_modules/redux/dist/redux.min.js":function(e,t,n){e.exports=function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return e[i].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0,t.compose=t.applyMiddleware=t.bindActionCreators=t.combineReducers=t.createStore=void 0;var o=n(2),r=i(o),a=n(7),s=i(a),u=n(6),p=i(u),c=n(5),d=i(c),l=n(1),f=i(l),v=n(3);i(v),t.createStore=r.default,t.combineReducers=s.default,t.bindActionCreators=p.default,t.applyMiddleware=d.default,t.compose=f.default},function(e,t){"use strict";t.__esModule=!0,t.default=function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];if(0===t.length)return function(e){return e};if(1===t.length)return t[0];var i=t[t.length-1],o=t.slice(0,-1);return function(){return o.reduceRight(function(e,t){return t(e)},i.apply(void 0,arguments))}}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0,t.ActionTypes=void 0,t.default=function e(t,n,i){function o(){g===v&&(g=v.slice())}function a(){return f}function p(e){if("function"!=typeof e)throw Error("Expected listener to be a function.");var t=!0;return o(),g.push(e),function(){if(t){t=!1,o();var n=g.indexOf(e);g.splice(n,1)}}}function c(e){if(!(0,r.default)(e))throw Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===e.type)throw Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(h)throw Error("Reducers may not dispatch actions.");try{h=!0,f=l(f,e)}finally{h=!1}for(var t=v=g,n=0;t.length>n;n++)t[n]();return e}var d;if("function"==typeof n&&void 0===i&&(i=n,n=void 0),void 0!==i){if("function"!=typeof i)throw Error("Expected the enhancer to be a function.");return i(e)(t,n)}if("function"!=typeof t)throw Error("Expected the reducer to be a function.");var l=t,f=n,v=[],g=v,h=!1;return c({type:u.INIT}),(d={dispatch:c,subscribe:p,getState:a,replaceReducer:function(e){if("function"!=typeof e)throw Error("Expected the nextReducer to be a function.");l=e,c({type:u.INIT})}})[s.default]=function(){var e,t=p;return(e={subscribe:function(e){function n(){e.next&&e.next(a())}if("object"!=typeof e)throw new TypeError("Expected the observer to be an object.");n();var i=t(n);return{unsubscribe:i}}})[s.default]=function(){return this},e},d};var o=n(4),r=i(o),a=n(12),s=i(a),u=t.ActionTypes={INIT:"@@redux/INIT"}},function(e,t){"use strict";t.__esModule=!0,t.default=function(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e);try{throw Error(e)}catch(e){}}},function(e,t,n){var i=n(8),o=n(9),r=n(11),a="[object Object]",s=Function.prototype,u=Object.prototype,p=s.toString,c=u.hasOwnProperty,d=p.call(Object),l=u.toString;e.exports=function(e){if(!r(e)||l.call(e)!=a||o(e))return!1;var t=i(e);if(null===t)return!0;var n=c.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&p.call(n)==d}},function(e,t,n){"use strict";t.__esModule=!0;var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e};t.default=function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];return function(e){return function(n,o,a){var s=e(n,o,a),u=s.dispatch,p=[],c={getState:s.getState,dispatch:function(e){return u(e)}};return p=t.map(function(e){return e(c)}),u=r.default.apply(void 0,p)(s.dispatch),i({},s,{dispatch:u})}}};var o=n(1),r=function(e){return e&&e.__esModule?e:{default:e}}(o)},function(e,t){"use strict";function n(e,t){return function(){return t(e.apply(void 0,arguments))}}t.__esModule=!0,t.default=function(e,t){if("function"==typeof e)return n(e,t);if("object"!=typeof e||null===e)throw Error("bindActionCreators expected an object or a function, instead received "+(null===e?"null":typeof e)+'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?');for(var i=Object.keys(e),o={},r=0;i.length>r;r++){var a=i[r],s=e[a];"function"==typeof s&&(o[a]=n(s,t))}return o}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){var n=t&&t.type,i=n&&'"'+n+'"'||"an action";return"Given action "+i+', reducer "'+e+'" returned undefined. To ignore an action, you must explicitly return the previous state.'}function r(e){Object.keys(e).forEach(function(t){var n=e[t],i=n(void 0,{type:a.ActionTypes.INIT});if(void 0===i)throw Error('Reducer "'+t+'" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined.');var o="@@redux/PROBE_UNKNOWN_ACTION_"+Math.random().toString(36).substring(7).split("").join(".");if(void 0===n(void 0,{type:o}))throw Error('Reducer "'+t+"\" returned undefined when probed with a random type. Don't try to handle "+a.ActionTypes.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined.')})}t.__esModule=!0,t.default=function(e){for(var t=Object.keys(e),n={},i=0;t.length>i;i++){var a=t[i];"function"==typeof e[a]&&(n[a]=e[a])}var s,u=Object.keys(n);try{r(n)}catch(e){s=e}return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1];if(s)throw s;for(var i=!1,r={},a=0;u.length>a;a++){var p=u[a],c=n[p],d=e[p],l=c(d,t);if(void 0===l){var f=o(p,t);throw Error(f)}r[p]=l,i=i||l!==d}return i?r:e}};var a=n(2),s=n(4),u=(i(s),n(3));i(u)},function(e,t,n){var i=n(10),o=i(Object.getPrototypeOf,Object);e.exports=o},function(e,t){e.exports=function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}},function(e,t){e.exports=function(e,t){return function(n){return e(t(n))}}},function(e,t){e.exports=function(e){return!!e&&"object"==typeof e}},function(e,t,n){e.exports=n(13)},function(e,t,n){(function(e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(14),o=function(e){return e&&e.__esModule?e:{default:e}}(i),r=void 0;void 0!==e?r=e:"undefined"!=typeof window&&(r=window);var a=(0,o.default)(r);t.default=a}).call(t,function(){return this}())},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t,n=e.Symbol;return"function"==typeof n?n.observable?t=n.observable:(t=n("observable"),n.observable=t):t="@@observable",t}}])},"./src/counts.js":function(e,t){t.getEditCountBucket=function(e){var t=void 0;return 0===e?t="0":e>=1&&e<=4?t="1-4":e>=5&&e<=99?t="5-99":e>=100&&e<=999?t="100-999":e>=1e3&&(t="1000+"),t+" edits"},t.getPreviewCountBucket=function(e){var t=void 0;return 0===e?t="0":e>=1&&e<=4?t="1-4":e>=5&&e<=20?t="5-20":e>=21&&(t="21+"),void 0!==t?t+" previews":"unknown"}},"./src/index.js":function(e,t,n){"use strict";n.r(t);var i={};n.d(i,"boot",function(){return Se}),n.d(i,"fetch",function(){return ke}),n.d(i,"linkDwell",function(){return Ie}),n.d(i,"abandon",function(){return xe}),n.d(i,"linkClick",function(){return Pe}),n.d(i,"previewDwell",function(){return Ae}),n.d(i,"previewShow",function(){return Le}),n.d(i,"pageviewLogged",function(){return Ne}),n.d(i,"showSettings",function(){return Ce}),n.d(i,"hideSettings",function(){return Oe}),n.d(i,"saveSettings",function(){return De}),n.d(i,"eventLogged",function(){return Ge}),n.d(i,"statsvLogged",function(){return Re});var o=n("./node_modules/redux/dist/redux.min.js"),r=n("./node_modules/redux-thunk/dist/redux-thunk.min.js"),a=n.n(r),s=jQuery,u={off:"off",on:"on",control:"control"},p={THUMBNAIL_SIZE:320*(s.bracketedDevicePixelRatio&&s.bracketedDevicePixelRatio()||1),EXTRACT_LENGTH:525},c={TYPE_GENERIC:"generic",TYPE_PAGE:"page",TYPE_DISAMBIGUATION:"disambiguation"};function d(e,t,n,i,o,r,a,s){var u=function(e){if(void 0===e||null===e||0===e.length)return;return e}(o);return{title:e,url:t,languageCode:n,languageDirection:i,extract:u,type:function(e,t){if(void 0===t)return c.TYPE_GENERIC;switch(e){case c.TYPE_GENERIC:case c.TYPE_DISAMBIGUATION:case c.TYPE_PAGE:return e;default:return c.TYPE_PAGE}}(r,u),thumbnail:a,pageId:s}}function l(e,t){return d(e,t,"","",[],"")}var f=jQuery,v=window.mediaWiki;function g(e,t){var n=e;return void 0===e?[]:0===n.length?[]:n=function(e,t){var n=void 0,i=void 0,o=[],r="<bi-"+Math.random()+">",a="<snip-"+Math.random()+">";return t=t.replace(/\s+/g," ").trim(),i=v.RegExp.escape(t),n=new RegExp("(^|\\s)("+i+")(|$)","i"),e=(e=(e=e.replace(/\s+/," ")).replace(n,"$1"+a+r+"$2"+a+"$3")).split(a),f.each(e,function(e,t){0===t.indexOf(r)?o.push(f("<b>").text(t.substring(r.length))):o.push(document.createTextNode(t))}),o}(n,t)}var h=300,w=jQuery;function m(e){if(e.query&&e.query.pages&&e.query.pages.length)return e.query.pages[0];throw new Error("API response `query.pages` is empty.")}function E(e){var t=w.extend({},e);return t.extract=g(e.extract,e.title),t}function T(e){return d(e.title,e.canonicalurl,e.pagelanguagehtmlcode,e.pagelanguagedir,e.extract,e.type,e.thumbnail,e.pageid)}var y="https://www.mediawiki.org/wiki/Specs/Summary/1.2.0",b=window.mediaWiki,_=jQuery;function S(e,t,n){function i(n){var i=t.endpoint;return e({url:i+encodeURIComponent(n),headers:{Accept:'application/json; charset=utf-8; profile="'+y+'"'}})}return{fetch:i,convertPageToModel:k,getPageSummary:function(e){var o=_.Deferred();return i(e).then(function(i){i&&i.title||(i=_.extend(!0,i||{},{title:e})),void 0===i.extract&&(i.extract=""),o.resolve(k(i,t.THUMBNAIL_SIZE,n))},function(t,n,i){404===t.status?o.resolve(l(e,new b.Title(e).getUrl())):o.reject("http",{xhr:t,textStatus:n,exception:i})}),o.promise()}}}function k(e,t,n){return d(e.title,new b.Title(e.title).getUrl(),e.lang,e.dir,n(e),e.type,e.thumbnail?function(e,t,n){var i,o=e.source.split("/"),r=o[o.length-1],a=void 0,s=void 0,u=void 0;return-1===(i=r.indexOf("px-"))?t:(a=r.substr(i+3),e.width>e.height?(s=n,u=Math.floor(n/e.width*e.height)):(s=Math.floor(n/e.height*e.width),u=n),s>=t.width&&-1===a.indexOf(".svg")?t:(o[o.length-1]=s+"px-"+a,{source:o.join("/"),width:s,height:u}))}(e.thumbnail,e.originalimage,t):void 0,e.pageid)}function I(e){var t=e.extract_html;return 0===t.length?[]:$.parseHTML(t)}function x(e){return g(e.extract,e.title)}var P=mediaWiki,A=jQuery;function L(e){var t=A.extend({},p,{endpoint:e.get("wgPopupsRestGatewayEndpoint")});switch(e.get("wgPopupsGateway")){case"mwApiPlain":return function(e,t){function n(n){return e.get({action:"query",prop:"info|extracts|pageimages|revisions|info",formatversion:2,redirects:!0,exintro:!0,exchars:t.EXTRACT_LENGTH,explaintext:!0,piprop:"thumbnail",pithumbsize:t.THUMBNAIL_SIZE,pilicense:"any",rvprop:"timestamp",inprop:"url",titles:n,smaxage:h,maxage:h,uselang:"content"},{headers:{"X-Analytics":"preview=1"}})}return{fetch:n,extractPageFromResponse:m,convertPageToModel:T,getPageSummary:function(e){return n(e).then(m).then(E).then(T)},formatPlainTextExtract:E}}(new P.Api,p);case"restbasePlain":return S(A.ajax,t,x);case"restbaseHTML":return S(A.ajax,t,I);default:throw new Error("Unknown gateway")}}var N="mwe-popups-enabled",C="ext.popups.core.previewCount";var O=window.mediaWiki,D=jQuery;var G=window.mediaWiki;function R(e){return G.html.escape(e)}function H(e){var t=R(e.heading),n=R(e.saveLabel),i=R(e.helpText);return("\n\t\t<section id='mwe-popups-settings'>\n\t\t\t<header>\n\t\t\t\t<div>\n\t\t\t\t\t<div class='mw-ui-icon mw-ui-icon-element mw-ui-icon-popups-close close'>Close</div>\n\t\t\t\t</div>\n\t\t\t\t<h1>"+t+"</h1>\n\t\t\t\t<div>\n\t\t\t\t\t<button class='save mw-ui-button mw-ui-progressive'>"+n+"</button>\n\t\t\t\t\t<button class='okay mw-ui-button mw-ui-progressive' style='display:none;'>"+R(e.okLabel)+"</button>\n\t\t\t\t</div>\n\t\t\t</header>\n\t\t\t<main id='mwe-popups-settings-form'>\n\t\t\t\t<form>\n\t\t\t\t\t"+function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map(function(e){var t=e.id,n=e.name,i=e.description,o=e.isChecked;return{id:R(t),name:R(n),description:i?R(i):"",isChecked:o}})}(e.choices).map(function(e){var t=e.id,n=e.name,i=e.description;return"\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tname='mwe-popups-setting'\n\t\t\t\t\t\t\t"+(e.isChecked?"checked":"")+"\n\t\t\t\t\t\t\tvalue='"+t+"'\n\t\t\t\t\t\t\ttype='radio'\n\t\t\t\t\t\t\tid='mwe-popups-settings-"+t+"'>\n\t\t\t\t\t\t<label for='mwe-popups-settings-"+t+"'>\n\t\t\t\t\t\t\t<span>"+n+"</span>\n\t\t\t\t\t\t\t"+i+"\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</p>"}).join("")+"\n\t\t\t\t</form>\n\t\t\t</main>\n\t\t\t<div class='mwe-popups-settings-help' style='display:none;'>\n\t\t\t\t<p>"+i+"</p>\n\t\t\t</div>\n\t\t</section>\n\t").trim()}var W=window.mediaWiki;var j=jQuery;function M(){var e=void 0,t=void 0;return function(n){var i,o,r;return e||(i=B(),o=W.config.get("wgExtensionAssetsPath")+"/Popups/resources/ext.popups.main/images/",r=[{id:"simple",name:W.msg("popups-settings-option-simple"),description:W.msg("popups-settings-option-simple-description"),image:o+"hovercard.svg",isChecked:!0},{id:"advanced",name:W.msg("popups-settings-option-advanced"),description:W.msg("popups-settings-option-advanced-description"),image:o+"navpop.svg"},{id:"off",name:W.msg("popups-settings-option-off")}],i||r.splice(1,1),e=$($.parseHTML(H({heading:W.msg("popups-settings-title"),closeLabel:W.msg("popups-settings-cancel"),saveLabel:W.msg("popups-settings-save"),helpText:W.msg("popups-settings-help"),okLabel:W.msg("popups-settings-help-ok"),descriptionText:W.msg("popups-settings-description"),choices:r}))),t=j("<div>").addClass("mwe-popups-overlay"),e.find(".save").click(function(){var t="simple"===e.find("input[name=mwe-popups-setting]:checked, #mwe-popups-settings").val();n.saveSettings(t)}),e.find(".close, .okay").click(n.hideSettings)),{appendTo:function(n){t.appendTo(n),e.appendTo(t)},show:function(){t.show()},hide:function(){t.hide()},toggleHelp:function(e){!function(e,t){var n=j("#mwe-popups-settings");t?(n.find("main, .save, .close").hide(),n.find(".mwe-popups-settings-help, .okay").show()):(n.find("main, .save, .close").show(),n.find(".mwe-popups-settings-help, .okay").hide())}(0,e)},setEnabled:function(t){var n="off";t?n="simple":B()&&(n="advanced"),e.find("#mwe-popups-settings-"+n).prop("checked",!0)}}}}function B(){return"undefined"!=typeof pg&&void 0!==pg.fn.disablePopups}function F(e,t){var n=void 0;e.subscribe(function(){var i=n;i!==(n=e.getState())&&t(i,n)})}var U=window.mediaWiki;function V(e,t){return n=function(e,t){var n,i=void 0,o=void 0,r=new RegExp(U.RegExp.escape(t.get("wgArticlePath")).replace("\\$1","(.+)"));try{i=new U.Uri(e)}catch(e){return}if(i.host===location.hostname)return(n=Object.keys(i.query).length)?1===n&&i.query.hasOwnProperty("title")?i.query.title:void 0:(o=r.exec(i.path))?decodeURIComponent(o[1]):void 0}(e.href,t),i=t.get("wgContentNamespaces"),n&&(o=U.Title.newFromText(n))&&$.inArray(o.namespace,i)>=0?o:null;var n,i,o}var Y=jQuery;function K(e){var t=Y.Deferred();return setTimeout(function(){t.resolve()},e),t.promise()}var X=n("./src/ui/pokey-mask.svg"),Q=n.n(X),q={portraitImage:{h:250,w:203},landscapeImage:{h:200,w:320}},z=jQuery;function Z(e){var t,n,i,o=void 0,r=void 0,a=void 0,s=void 0,u=void 0,p=z.bracketedDevicePixelRatio();return e?(t=e.width<e.height,n=e.width/p,i=e.height/p,!t&&n<q.landscapeImage.w||t&&i<q.portraitImage.h||e.source.indexOf("\\")>-1||e.source.indexOf("'")>-1||e.source.indexOf('"')>-1?null:(t?(o=n>q.portraitImage.w?(n-q.portraitImage.w)/-2:q.portraitImage.w-n,r=i>q.portraitImage.h?(i-q.portraitImage.h)/-2:0,a=q.portraitImage.w,s=q.portraitImage.h):(o=0,r=i>q.landscapeImage.h?(i-q.landscapeImage.h)/-2:0,a=q.landscapeImage.w+3,s=i>q.landscapeImage.h?q.landscapeImage.h:i,u="mwe-popups-mask"),{el:function(e,t,n,i,o,r,a,s,u){var p=void 0,c="http://www.w3.org/2000/svg";return(p=z(document.createElementNS(c,"image")))[0].setAttributeNS("http://www.w3.org/1999/xlink","href",t),p.addClass(e).attr({x:n,y:i,width:o,height:r,"clip-path":"url(#"+u+")"}),z(document.createElementNS(c,"svg")).attr({xmlns:c,width:a,height:s}).append(p)}(t?"mwe-popups-is-tall":"mwe-popups-is-not-tall",e.source,o,r,n,i,a,s,u),isTall:t,width:n,height:i})):null}function J(e,t,n,i){var o=e.title,r=e.url,a=e.type;return o=R(o),n=R(n),i=R(i),("\n\t<div class='mwe-popups mwe-popups-type-"+a+"' role='tooltip' aria-hidden>\n\t\t<div class='mwe-popups-container'>\n\t\t\t<div class='mw-ui-icon mw-ui-icon-element mw-ui-icon-preview-"+a+"'></div>\n\t\t\t"+(t?"<strong class='mwe-popups-title'>"+o+"</strong>":"")+"\n\t\t\t<a href='"+r+"' class='mwe-popups-extract'>\n\t\t\t\t\t<span class='mwe-popups-message'>"+n+"</span>\n\t\t\t</a>\n\t\t\t<footer>\n\t\t\t\t<a href='"+r+"' class='mwe-popups-read-link'>"+i+"</a>\n\t\t\t</footer>\n\t\t</div>\n\t</div>\n\t").trim()}var ee=window.mediaWiki,te=jQuery,ne=te(window),ie=450,oe=320,re=8;function ae(){var e;e=document.body,te("<div>").attr("id","mwe-popups-svg").html(Q.a).appendTo(e)}function se(e){var t=function(e){switch(e.type){case c.TYPE_PAGE:return function(e){var t=Z(e.thumbnail),n=null!==t,i=e.extract,o=void 0;o=te(te.parseHTML(function(e,t){var n=e.url,i=e.languageCode,o=e.languageDirection;return("\n\t\t<div class='mwe-popups' role='tooltip' aria-hidden>\n\t\t\t<div class='mwe-popups-container'>\n\t\t\t\t"+(t?"<a href='"+n+"' class='mwe-popups-discreet'></a>":"")+"\n\t\t\t\t<a dir='"+o+"' lang='"+i+"' class='mwe-popups-extract' href='"+n+"'></a>\n\t\t\t\t<footer>\n\t\t\t\t\t<a class='mwe-popups-settings-icon mw-ui-icon mw-ui-icon-element mw-ui-icon-popups-settings'></a>\n\t\t\t\t</footer>\n\t\t\t</div>\n\t\t</div>\n\t").trim()}(e,n))),n&&o.find(".mwe-popups-discreet").append(t.el);i&&o.find(".mwe-popups-extract").append(i);return{el:o,hasThumbnail:n,thumbnail:t,isTall:n&&t.isTall}}(e);case c.TYPE_DISAMBIGUATION:return function(e){var t=ee.msg("popups-preview-disambiguation"),n=ee.msg("popups-preview-disambiguation-link");return{el:te(te.parseHTML(J(e,!0,t,n))),hasThumbnail:!1,isTall:!1}}(e);default:return function(e){var t=ee.msg("popups-preview-no-preview"),n=ee.msg("popups-preview-footer-read");return{el:te(te.parseHTML(J(e,!1,t,n))),hasThumbnail:!1,isTall:!1}}(e)}}(e);return{show:function(e,n,i){return function(e,t,n,i,o,r){var a=function(e,t,n,i,o){var r=!1,a=!1,s=t.pageY?ue(t.pageY-i.scrollTop,n.clientRects,!1)+i.scrollTop+o:n.offset.top+n.height+o,u=t.clientY?t.clientY:s,p=t.pageX?t.pageX:n.offset.left;p>i.width/2&&(p+=t.pageX?0:n.width,p-=e?ie:oe,r=!0);t.pageX&&(p+=r?20:-20);u>i.height/2&&(a=!0,s=n.offset.top,t.pageY&&(s=ue(t.pageY-i.scrollTop,n.clientRects,!0)+i.scrollTop),s-=o);return{offset:{top:s,left:p},flippedX:r,flippedY:a}}(e.isTall,{pageX:t.pageX,pageY:t.pageY,clientY:t.clientY},{clientRects:n.get(0).getClientRects(),offset:n.offset(),width:n.width(),height:n.height()},{scrollTop:ne.scrollTop(),width:ne.width(),height:ne.height()},re);return e.el.appendTo(r),function(e,t,n,i,o){var r=e.el,a=e.isTall,s=e.hasThumbnail,u=e.thumbnail,p=t.flippedY,c=t.flippedX,d=t.offset.top;!p&&!a&&s&&u.height<i&&r.find(".mwe-popups-extract").css("margin-top",u.height-o),r.addClass(n.join(" ")),p&&(d-=r.outerHeight()),r.css({top:d,left:t.offset.left+"px"}),p&&s&&r.find("image")[0].removeAttribute("clip-path"),p&&c&&s&&a&&r.find("image")[0].setAttribute("clip-path","url(#mwe-popups-landscape-mask-flip)"),c&&!p&&s&&!a&&r.find("image")[0].setAttribute("clip-path","url(#mwe-popups-mask-flip)"),c&&!p&&s&&a&&r.removeClass("mwe-popups-no-image-tri").find("image")[0].setAttribute("clip-path","url(#mwe-popups-landscape-mask)")}(e,a,function(e,t){var n=[];return t.flippedY?n.push("mwe-popups-fade-in-down"):n.push("mwe-popups-fade-in-up"),t.flippedY&&t.flippedX&&n.push("flipped_x_y"),t.flippedY&&!t.flippedX&&n.push("flipped_y"),t.flippedX&&!t.flippedY&&n.push("flipped_x"),e.hasThumbnail&&!e.isTall||t.flippedY||n.push("mwe-popups-no-image-tri"),!e.hasThumbnail||e.isTall||t.flippedY||n.push("mwe-popups-image-tri"),e.isTall?n.push("mwe-popups-is-tall"):n.push("mwe-popups-is-not-tall"),n}(e,a),q.landscapeImage.h,re),e.el.show(),K(200).then(function(){!function(e,t){e.el.on("mouseenter",t.previewDwell).on("mouseleave",t.previewAbandon),e.el.click(t.click),e.el.find(".mwe-popups-settings-icon").attr("href",t.settingsUrl).click(function(e){e.stopPropagation(),t.showSettings(e)})}(e,i)}).then(function(){i.previewShow(o)})}(t,e,te(e.target),n,i,document.body)},hide:function(){return function(e){var t=void 0,n=void 0;return t=e.el.hasClass("mwe-popups-fade-in-up")?"mwe-popups-fade-in-up":"mwe-popups-fade-in-down",n="mwe-popups-fade-in-up"===t?"mwe-popups-fade-out-down":"mwe-popups-fade-out-up",e.el.removeClass(t).addClass(n),K(150).then(function(){e.el.remove()})}(t)}}}function ue(e,t,n){var i=void 0,o=void 0,r=null;return te.each(t,function(t,a){o=Math.abs(e-a.top+e-a.bottom),(null===r||r>o)&&(r=o,i=n?Math.floor(a.top):Math.ceil(a.bottom))}),i}var pe=window.mediaWiki,ce=jQuery;var de=jQuery;var le=jQuery;function fe(e,t,n){return e[t]&&e[t][n]}function ve(e,t,n,i,o){var r=fe(t,n,i);e&&fe(e,n,i)!==r&&o(r)}var ge={footerLink:function(e){var t=void 0;return function(n,i){var o,r;void 0===t&&(o=ce("<li>").append(ce("<a>").attr("href","#").text(pe.message("popups-settings-enable").text())),r=void 0,o.hide(),0===(r=ce("#footer-places, #f-list")).length&&(r=ce("#footer li").parent()),r.append(o),(t=o).click(function(t){t.preventDefault(),e.showSettings()})),i.settings.shouldShowFooterLink?t.show():t.hide()}},eventLogging:function(e,t,n){return function(i,o){var r=o.eventLogging,a=r.event;a&&(a=de.extend(!0,{},r.baseData,a,{timestamp:n()}),t("event.Popups",a),e.eventLogged(a))}},linkTitle:function(){var e=void 0;return function(t,n){var i,o=t&&t.preview.activeLink;n.preview.enabled&&(o&&t.preview.activeLink!==n.preview.activeLink&&(i=t.preview.activeLink,le(i).attr("title",e),e=void 0),n.preview.activeLink&&function(t){var n=le(t);e||(e=n.attr("title"),n.attr("title",""))}(n.preview.activeLink))}},pageviews:function(e,t){return function(n,i){var o=void 0;i.pageviews&&i.pageviews.pageview&&i.pageviews.page&&(o=i.pageviews.page,t("event.VirtualPageView",$.extend({},{source_page_id:o.id,source_namespace:o.namespaceId,source_title:o.title,source_url:o.url},i.pageviews.pageview)),e.pageviewLogged())}},render:function(e){var t=void 0;return function(n,i){i.preview.shouldShow&&!t?(t=se(i.preview.fetchResponse)).show(i.preview.activeEvent,e,i.preview.activeToken):!i.preview.shouldShow&&t&&(t.hide(),t=void 0)}},settings:function(e,t){var n=void 0;return function(i,o){i&&(!1===i.settings.shouldShow&&!0===o.settings.shouldShow?(n||(n=t(e)).appendTo(document.body),n.setEnabled(o.preview.enabled),n.show()):!0===i.settings.shouldShow&&!1===o.settings.shouldShow&&n.hide(),i.settings.showHelp!==o.settings.showHelp&&n.toggleHelp(o.settings.showHelp))}},statsv:function(e,t){return function(n,i){var o=i.statsv;o.action&&(t(o.action,o.data),e.statsvLogged())}},syncUserSettings:function(e){return function(t,n){ve(t,n,"eventLogging","previewCount",e.setPreviewCount),ve(t,n,"preview","enabled",e.setIsEnabled)}}},he={BOOT:"BOOT",LINK_DWELL:"LINK_DWELL",ABANDON_START:"ABANDON_START",ABANDON_END:"ABANDON_END",LINK_CLICK:"LINK_CLICK",FETCH_START:"FETCH_START",FETCH_END:"FETCH_END",FETCH_COMPLETE:"FETCH_COMPLETE",FETCH_FAILED:"FETCH_FAILED",PAGEVIEW_LOGGED:"PAGEVIEW_LOGGED",PREVIEW_DWELL:"PREVIEW_DWELL",PREVIEW_SHOW:"PREVIEW_SHOW",PREVIEW_CLICK:"PREVIEW_CLICK",PREVIEW_SEEN:"PREVIEW_SEEN",SETTINGS_SHOW:"SETTINGS_SHOW",SETTINGS_HIDE:"SETTINGS_HIDE",SETTINGS_CHANGE:"SETTINGS_CHANGE",EVENT_LOGGED:"EVENT_LOGGED",STATSV_LOGGED:"STATSV_LOGGED"},we=jQuery,me=window.mediaWiki,Ee=150,Te=1e3,ye=500,be=300;function _e(e){return e.timestamp=me.now(),e}function Se(e,t,n,i,o,r){var a=o.get("wgUserEditCount"),s=n.getPreviewCount();return{type:he.BOOT,isEnabled:e,isNavPopupsEnabled:o.get("wgPopupsConflictsWithNavPopupGadget"),sessionToken:t.sessionId(),pageToken:i(),page:{url:r,title:o.get("wgTitle"),namespaceId:o.get("wgNamespaceNumber"),id:o.get("wgArticleId")},user:{isAnon:t.isAnon(),editCount:a,previewCount:s}}}function ke(e,t,n,i){var o=t.getPrefixedDb(),r=t.namespace;return function(a){var s;return a(_e({type:he.FETCH_START,el:n,title:o,namespaceId:r})),s=e.getPageSummary(o).then(function(e){return a(_e({type:he.FETCH_END,el:n})),e}).catch(function(e){throw a({type:he.FETCH_FAILED,el:n}),e}),we.when(s,K(ye-Ee)).then(function(e){a({type:he.FETCH_COMPLETE,el:n,result:e,token:i})}).catch(function(e,r){r&&r.xhr&&0===r.xhr.readyState&&"error"===r.textStatus&&""===r.exception||a({type:he.FETCH_COMPLETE,el:n,result:l(o,t.getUrl()),token:i})})}}function Ie(e,t,n,i,o){var r=o(),a=e.getPrefixedDb(),s=e.namespace;return function(o,u){var p=_e({type:he.LINK_DWELL,el:t,event:n,token:r,title:a,namespaceId:s});function c(){return u().preview.activeToken===r}return o(p),c()?K(Ee).then(function(){if(u().preview.enabled&&c())return o(ke(i,e,t,r))}):we.Deferred().resolve().promise()}}function xe(){return function(e,t){var n=t().preview.activeToken;return n?(e(_e({type:he.ABANDON_START,token:n})),K(be).then(function(){e({type:he.ABANDON_END,token:n})})):we.Deferred().resolve().promise()}}function Pe(e){return _e({type:he.LINK_CLICK,el:e})}function Ae(){return{type:he.PREVIEW_DWELL}}function Le(e){return function(t,n){return t(_e({type:he.PREVIEW_SHOW,token:e})),K(Te).then(function(){var i=n().preview,o=i&&i.fetchResponse,r=i&&i.activeToken,a=o&&[c.TYPE_PAGE,c.TYPE_DISAMBIGUATION].indexOf(o.type)>-1;r&&r===e&&o&&a&&t({type:he.PREVIEW_SEEN,title:o.title,pageId:o.pageId,namespace:0})})}}function Ne(){return{type:he.PAGEVIEW_LOGGED}}function Ce(){return{type:he.SETTINGS_SHOW}}function Oe(){return{type:he.SETTINGS_HIDE}}function De(e){return function(t,n){t({type:he.SETTINGS_CHANGE,wasEnabled:n().preview.enabled,enabled:e})}}function Ge(e){return{type:he.EVENT_LOGGED,event:e}}function Re(){return{type:he.STATSV_LOGGED}}function He(e,t){var n={},i=void 0;for(i in e)e.hasOwnProperty(i)&&!t.hasOwnProperty(i)&&(n[i]=e[i]);for(i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return n}var We=n("./src/counts.js");function je(e,t){return t.linkInteractionToken=e.token,t.pageTitleHover=e.title,t.namespaceIdHover=e.namespaceId,void 0!==e.timeToPreviewShow&&(t.previewType=e.previewType,t.perceivedWait=e.timeToPreviewShow),t}function Me(e){var t={totalInteractionTime:Math.round(e.finished-e.started)};if(!e.finalized)return t.action=e.timeToPreviewShow?"dismissed":"dwelledButAbandoned",je(e,t)}var Be={eventLogging:function(e,t){var n,i,o=void 0,r=void 0,a=[he.FETCH_COMPLETE,he.ABANDON_END,he.PREVIEW_SHOW];if(void 0===e&&(e={previewCount:void 0,baseData:{},interaction:void 0,event:void 0}),-1!==a.indexOf(t.type)&&(!e.interaction||t.token!==e.interaction.token))return e;if(!e.interaction&&t.type!==he.BOOT&&t.type!==he.LINK_DWELL&&t.type!==he.EVENT_LOGGED&&t.type!==he.SETTINGS_CHANGE)return e;switch(t.type){case he.BOOT:return He(e,{previewCount:t.user.previewCount,baseData:(n=t,i={pageTitleSource:n.page.title,namespaceIdSource:n.page.namespaceId,pageIdSource:n.page.id,isAnon:n.user.isAnon,popupEnabled:n.isEnabled,pageToken:n.pageToken,sessionToken:n.sessionToken,previewCountBucket:We.getPreviewCountBucket(n.user.previewCount),hovercardsSuppressedByGadget:n.isNavPopupsEnabled},n.user.isAnon||(i.editCountBucket=We.getEditCountBucket(n.user.editCount)),i),event:{action:"pageLoaded"}});case he.EVENT_LOGGED:return r=He(e,{event:void 0}),t.event.linkInteractionToken&&e.interaction&&t.event.linkInteractionToken===e.interaction.token&&(r.interaction=void 0),r;case he.FETCH_COMPLETE:return He(e,{interaction:He(e.interaction,{previewType:t.result.type})});case he.PREVIEW_SHOW:return He(e,{previewCount:o=e.previewCount+1,baseData:He(e.baseData,{previewCountBucket:We.getPreviewCountBucket(o)}),interaction:He(e.interaction,{timeToPreviewShow:Math.round(t.timestamp-e.interaction.started)})});case he.LINK_DWELL:return e.interaction&&t.el===e.interaction.link?He(e,{interaction:He(e.interaction,{isUserDwelling:!0})}):He(e,{interaction:{link:t.el,title:t.title,namespaceId:t.namespaceId,token:t.token,started:t.timestamp,isUserDwelling:!0},event:e.interaction?Me(e.interaction):void 0});case he.PREVIEW_DWELL:return He(e,{interaction:He(e.interaction,{isUserDwelling:!0})});case he.LINK_CLICK:return He(e,{interaction:He(e.interaction,{finalized:!0}),event:je(e.interaction,{action:"opened",totalInteractionTime:Math.round(t.timestamp-e.interaction.started)})});case he.ABANDON_START:return He(e,{interaction:He(e.interaction,{finished:t.timestamp,isUserDwelling:!1})});case he.ABANDON_END:return e.interaction.isUserDwelling?e:He(e,{interaction:void 0,event:Me(e.interaction)});case he.SETTINGS_SHOW:return He(e,{event:je(e.interaction,{action:"tapped settings cog"})});case he.SETTINGS_CHANGE:return t.wasEnabled&&!t.enabled?He(e,{event:{action:"disabled",popupEnabled:!1}}):e;default:return e}},pageviews:function(e,t){switch(void 0===e&&(e={pageview:void 0}),t.type){case he.BOOT:return He(e,{page:t.page});case he.PAGEVIEW_LOGGED:return He(e,{pageview:void 0});case he.PREVIEW_SEEN:return He(e,{pageview:{page_title:t.title,page_id:t.pageId,page_namespace:t.namespace}});default:return e}},preview:function(e,t){switch(void 0===e&&(e={enabled:void 0,activeLink:void 0,activeEvent:void 0,activeToken:"",shouldShow:!1,isUserDwelling:!1}),t.type){case he.BOOT:return He(e,{enabled:t.isEnabled});case he.SETTINGS_CHANGE:return He(e,{enabled:t.enabled});case he.LINK_DWELL:return t.el!==e.activeLink?He(e,{activeLink:t.el,activeEvent:t.event,activeToken:t.token,shouldShow:!1,isUserDwelling:!0}):He(e,{isUserDwelling:!0});case he.ABANDON_END:return t.token!==e.activeToken||e.isUserDwelling?e:He(e,{activeLink:void 0,activeToken:void 0,activeEvent:void 0,fetchResponse:void 0,shouldShow:!1});case he.PREVIEW_DWELL:return He(e,{isUserDwelling:!0});case he.ABANDON_START:return He(e,{isUserDwelling:!1});case he.FETCH_START:return He(e,{fetchResponse:void 0});case he.FETCH_COMPLETE:if(t.token===e.activeToken)return He(e,{fetchResponse:t.result,shouldShow:e.isUserDwelling});default:return e}},settings:function(e,t){switch(void 0===e&&(e={shouldShow:!1,showHelp:!1,shouldShowFooterLink:!1}),t.type){case he.SETTINGS_SHOW:return He(e,{shouldShow:!0,showHelp:!1});case he.SETTINGS_HIDE:return He(e,{shouldShow:!1,showHelp:!1});case he.SETTINGS_CHANGE:return t.wasEnabled===t.enabled?He(e,{shouldShow:!1}):He(e,{shouldShow:!t.enabled,showHelp:!t.enabled,shouldShowFooterLink:!t.enabled});case he.BOOT:return He(e,{shouldShowFooterLink:t.user.isAnon&&!t.isEnabled});default:return e}},statsv:function(e,t){switch(e=e||{},t.type){case he.FETCH_START:return He(e,{fetchStartedAt:t.timestamp});case he.FETCH_END:return He(e,{action:"timing.PagePreviewsApiResponse",data:t.timestamp-e.fetchStartedAt});case he.FETCH_FAILED:return He(e,{action:"counter.PagePreviewsApiFailure",data:1});case he.LINK_DWELL:return He(e,{linkDwellStartedAt:t.timestamp});case he.PREVIEW_SHOW:return He(e,{action:"timing.PagePreviewsPreviewShow",data:t.timestamp-e.linkDwellStartedAt});case he.STATSV_LOGGED:return He(e,{action:null,data:null});default:return e}}};var Fe=function(e,t,n){var i=t/2;return t?e.getBucket({name:"ext.Popups.visibility",enabled:!0,buckets:{off:1-t,control:i,on:i}},n):"on"},Ue=mediaWiki,Ve=jQuery,Ye=[".extiw",".image",".new",".internal",".external",".oo-ui-buttonedElement-button",".cancelLink a"];function Ke(e,t,n,i){return function(e,t,n,i){return!0===t.get("debug")||!!t.get("wgPopupsEventLogging")&&!(!i.navigator||!$.isFunction(i.navigator.sendBeacon))&&e.isAnon()&&n!==u.off}(e,t,n,i)?Ue.track:Ve.noop}function Xe(){return window.performance&&window.performance.now?Math.round(window.performance.now()):null}Ue.requestIdleCallback(function(){var e,t,n,r,s,p,c,d,l,f=o.compose,v=void 0,g=void 0,h=Ue.user.generateRandomSessionId,w=L(Ue.config),m=void 0,E=void 0;e=Fe(Ue.experiments,Ue.config.get("wgPopupsAnonsExperimentalGroupSize"),Ue.user.sessionId()),d=Ue.storage,m={getIsEnabled:function(){return"0"!==d.get(N)},setIsEnabled:function(e){d.set(N,e?"1":"0")},hasIsEnabled:function(){var e=d.get(N);return!1!==Boolean(e)},getPreviewCount:function(){var e=d.get(C),t=void 0;return!1===e?-1:null===e?0:(t=parseInt(e,10),isNaN(t)&&(t=0,this.setPreviewCount(t)),t)},setPreviewCount:function(e){d.set(C,e.toString())}},n=M(),l=Ue.experiments,E={weightedBoolean:function(e,t,n){return"true"===l.getBucket({enabled:!0,name:e,buckets:{true:t,false:1-t}},n)}},r=function(e,t,n){return function(e,t,n){var i=t.get("wgPopupsStatsvSamplingRate",0);return n.weightedBoolean("ext.Popups.statsv",i,e.sessionId())}(e,t,n)?Ue.track:Ve.noop}(Ue.user,Ue.config,E),g=Ue.config.get("wgPopupsVirtualPageViews")?Ue.track:Ve.noop,s=Ke(Ue.user,Ue.config,e,window),p=function(e,t,n,i){return!n.get("wgPopupsConflictsWithNavPopupGadget")&&(e.isAnon()?!n.get("wgPopupsBetaFeature")&&(t.hasIsEnabled()?t.getIsEnabled():i===u.on):n.get("wgPopupsShouldSendModuleToUser"))}(Ue.user,m,Ue.config,e),!0===Ue.config.get("debug")&&(f=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||f),t=o.createStore(o.combineReducers(Be),f(o.applyMiddleware(a.a))),v=o.bindActionCreators(i,t.dispatch),c=function(e,t,n){var i=e.get("wgPopupsBetaFeature"),o=void 0,r=void 0,a=D.noop;return t.isAnon()?a=function(e){e.preventDefault(),n.showSettings()}:(o="Special:Preferences#mw-prefsection-",o+=i?"betafeatures":"rendering",r=O.Title.newFromText(o).getUrl()),{settingsUrl:r,showSettings:a,previewDwell:n.previewDwell,previewAbandon:n.abandon,previewShow:n.previewShow,click:n.linkClick}}(Ue.config,Ue.user,v),function(e,t,n,i,o,r,a,s,u){F(e,ge.footerLink(t)),F(e,ge.linkTitle()),F(e,ge.render(o)),F(e,ge.statsv(t,r)),F(e,ge.syncUserSettings(n)),F(e,ge.settings(t,i)),F(e,ge.eventLogging(t,a,u)),F(e,ge.pageviews(t,s))}(t,v,m,n,c,r,s,g,Xe),v.boot(p,Ue.user,m,h,Ue.config,window.location.href),Ue.popups=function(e){return{isEnabled:function(){return e.getState().preview.enabled}}}(t),Ue.hook("wikipage.content").add(function(e){var t="a[href][title]:not("+Ye.join(", ")+")";ae(),e.on("mouseover keyup",t,function(e){var t=V(this,Ue.config);t&&v.linkDwell(t,this,e,w,h)}).on("mouseout blur",t,function(){V(this,Ue.config)&&v.abandon(this)}).on("click",t,function(){V(this,Ue.config)&&v.linkClick(this)})})}),window.Redux=o,window.ReduxThunk=r},"./src/ui/pokey-mask.svg":function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" width="0" height="0"><defs><clippath id="mwe-popups-mask"><polygon points="0 8, 10 8, 18 0, 26 8, 1000 8, 1000 1000, 0 1000"></polygon></clippath><clippath id="mwe-popups-mask-flip"><polygon points="0 8, 274 8, 282 0, 290 8, 1000 8, 1000 1000, 0 1000"></polygon></clippath><clippath id="mwe-popups-landscape-mask"><polygon points="0 8, 174 8, 182 0, 190 8, 1000 8, 1000 1000, 0 1000"></polygon></clippath><clippath id="mwe-popups-landscape-mask-flip"><polygon points="0 0, 1000 0, 1000 242, 190 242, 182 250, 174 242, 0 242"></polygon></clippath></defs></svg>'}});
//# sourceMappingURL=index.js.json